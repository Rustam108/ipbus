!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("logger-console"),require("utils/validate")):"function"==typeof define&&define.amd?define(["exports","logger-console","utils/validate"],t):t((e=e||self)["message-dispatcher"]={},e.loggerConsole,e.validate)}(this,function(e,n,i){"use strict";function r(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}var o=(t.prototype.process=function(e){return this.send("publish",e)},t.prototype.send=function(e,t){var s={event:t,method:e,originId:this.originId};try{this.source.postMessage(s,"*"),this.logger.trace("send message",s)}catch(e){return this.logger.error("failed to send message",s),!1}return!0},t);function t(e,t,s){this.source=e,this.originId=t||r(),this.logger=new n.LoggerConsole(this.originId,void 0,s),this.logger.trace("created message listener")}var s,a=(c.prototype.onSubscribe=function(e,t){var s={channel:e};this.getAllListeners().forEach(function(e){e!==t&&e.send("subscribe",s)})},c.prototype.onUnsubscribe=function(e,t){var s={channel:e};this.getAllListeners().forEach(function(e){e!==t&&e.send("unsubscribe",s)})},c.prototype.createListener=function(e,t,s){var r=this.listenersById[t];return i.assertNull(r,"Listener with originId "+t+" already exists"),r=new o(e,t,s),this.listenersById[t]=r},c.prototype.getListener=function(e){return this.listenersById[e]},c.prototype.getAllListeners=function(){var t=this;return Object.keys(this.listenersById).map(function(e){return t.listenersById[e]})},c);function c(e,t){var r=this;this.listenersById={},this.onMessage=function(e){if(!e||void 0===e.data.originId)return!1;var t=e.data,s=r.getListener(t.originId)||r.createListener(e.source,t.originId,r.logger);if(t.method)switch(r.logger.trace("received event",t.method,"for",t.originId),t.method){case"unsubscribe":r.bus.unsubscribe(t.event.channel,s);break;case"subscribe":r.bus.subscribe(t.event.channel,s);break;case"publish":r.bus.publish(t.event.channel,t.event.data,s);break;default:if(r.callback)return r.callback(e,s)}else if(r.callback)return r.callback(e,s);return e.preventDefault(),e.stopPropagation(),!0},this.bus=e,this.callback=t,this.logger=new n.LoggerConsole("message-bridge",void 0,e.logger),window.addEventListener("message",this.onMessage,!1),this.logger.info("Message dispatcher was created")}e.MessageDispatcher=a,e.MessageListener=o,e.generateOriginId=r,e.initMessageDispatcher=function(e,t){return s?s.logger.warn("message dispatcher already up"):s=new a(e,t),e.addDispatcher(s),s},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=message-dispatcher.min.js.map
