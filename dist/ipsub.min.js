!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).ipbus={})}(this,function(e){"use strict";var n,t;(t=n=n||{})[t.silent=1]="silent",t[t.error=2]="error",t[t.warn=3]="warn",t[t.info=4]="info",t[t.trace=5]="trace",t[t.debug=6]="debug";var r=(i.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level>=n.info&&this.log(console.log,e,!1)},i.prototype.trace=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level>=n.trace&&this.log(console.log,e,!1)},i.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level>=n.debug&&this.log(console.debug,e,!1)},i.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level>=n.warn&&this.log(console.warn,e,!0)},i.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level>=n.error&&this.log(console.error,e,!0)},i.prototype.log=function(e,t,r){var n=[],i=new Date,o=i.getHours(),s=i.getMinutes(),u=i.getSeconds(),p=i.getMilliseconds(),a=p<=99?"0"+p:p;n.push(String((o<=9?"0"+o:o)+":"+(s<=9?"0"+s:s)+":"+(u<=9?"0"+u:u)+"."+(p<=9?"00"+p:a))),this.prefix&&n.push(this.prefix+":");for(var f=0;f<t.length;f++)n.push(t[f]);if(r)try{var l,h=Error().stack;h&&(l=h.split("\n")[3],n.push(l))}catch(e){}e.apply(console,n)},i);function i(e,t,r){this.prefix=r?r.prefix:"",Array.isArray(e)?this.prefix+=e.map(function(e){return"["+e+"]"}).join(""):e&&(this.prefix+="["+e+"]"),this.level=t||(r?r.level:n.info)}function o(e,t){void 0===t&&(t={});for(var o=function(e){for(var t=[],r=0;r<e.length;){var n=e[r];if("*"!==n&&"+"!==n&&"?"!==n)if("\\"!==n)if("{"!==n)if("}"!==n)if(":"!==n)if("("!==n)t.push({type:"CHAR",index:r,value:e[r++]});else{var i=1,o="";if("?"===e[u=r+1])throw new TypeError('Pattern cannot start with "?" at '+u);for(;u<e.length;)if("\\"!==e[u]){if(")"===e[u]){if(0===--i){u++;break}}else if("("===e[u]&&(i++,"?"!==e[u+1]))throw new TypeError("Capturing groups are not allowed at "+u);o+=e[u++]}else o+=e[u++]+e[u++];if(i)throw new TypeError("Unbalanced pattern at "+r);if(!o)throw new TypeError("Missing pattern at "+r);t.push({type:"PATTERN",index:r,value:o}),r=u}else{for(var s="",u=r+1;u<e.length;){var p=e.charCodeAt(u);if(!(48<=p&&p<=57||65<=p&&p<=90||97<=p&&p<=122||95===p))break;s+=e[u++]}if(!s)throw new TypeError("Missing parameter name at "+r);t.push({type:"NAME",index:r,value:s}),r=u}else t.push({type:"CLOSE",index:r,value:e[r++]});else t.push({type:"OPEN",index:r,value:e[r++]});else t.push({type:"ESCAPED_CHAR",index:r++,value:e[r++]});else t.push({type:"MODIFIER",index:r,value:e[r++]})}return t.push({type:"END",index:r,value:""}),t}(e),r=t.prefixes,n=void 0===r?"./":r,i="[^"+w(t.delimiter||"/#?")+"]+?",s=[],u=0,p=0,a="",f=function(e){if(p<o.length&&o[p].type===e)return o[p++].value},l=function(e){var t=f(e);if(void 0!==t)return t;var r=o[p],n=r.type,i=r.index;throw new TypeError("Unexpected "+n+" at "+i+", expected "+e)},h=function(){for(var e,t="";e=f("CHAR")||f("ESCAPED_CHAR");)t+=e;return t};p<o.length;){var c,d,v,g,x,y=f("CHAR"),E=f("NAME"),b=f("PATTERN");E||b?(d=y||"",-1===n.indexOf(d)&&(a+=d,d=""),a&&(s.push(a),a=""),s.push({name:E||u++,prefix:d,suffix:"",pattern:b||i,modifier:f("MODIFIER")||""})):(c=y||f("ESCAPED_CHAR"))?a+=c:(a&&(s.push(a),a=""),f("OPEN")?(d=h(),v=f("NAME")||"",g=f("PATTERN")||"",x=h(),l("CLOSE"),s.push({name:v||(g?u++:""),pattern:v&&!g?i:g,prefix:d,suffix:x,modifier:f("MODIFIER")||""})):l("END"))}return s}function s(e,t){var r=[];return function(s,u,e){void 0===e&&(e={});var t=e.decode,p=void 0===t?function(e){return e}:t;return function(e){var r=s.exec(e);if(!r)return!1;for(var t=r[0],n=r.index,i=Object.create(null),o=1;o<r.length;o++)!function(e){if(void 0===r[e])return;var t=u[e-1];"*"===t.modifier||"+"===t.modifier?i[t.name]=r[e].split(t.prefix+t.suffix).map(function(e){return p(e,t)}):i[t.name]=p(r[e],t)}(o);return{path:t,index:n,params:i}}}(p(e,r,t),r,t)}function w(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function A(e){return e&&e.sensitive?"":"i"}function u(e,t,r){return function(e,t,r){void 0===r&&(r={});for(var n=r.strict,i=void 0!==n&&n,o=r.start,s=void 0===o||o,u=r.end,p=void 0===u||u,a=r.encode,f=void 0===a?function(e){return e}:a,l="["+w(r.endsWith||"")+"]|$",h="["+w(r.delimiter||"/#?")+"]",c=s?"^":"",d=0,v=e;d<v.length;d++){var g,x,y,E=v[d];"string"==typeof E?c+=w(f(E)):(g=w(f(E.prefix)),x=w(f(E.suffix)),E.pattern?(t&&t.push(E),g||x?"+"===E.modifier||"*"===E.modifier?(y="*"===E.modifier?"?":"",c+="(?:"+g+"((?:"+E.pattern+")(?:"+x+g+"(?:"+E.pattern+"))*)"+x+")"+y):c+="(?:"+g+"("+E.pattern+")"+x+")"+E.modifier:c+="("+E.pattern+")"+E.modifier):c+="(?:"+g+x+")"+E.modifier)}{var b,m;p?(i||(c+=h+"?"),c+=r.endsWith?"(?="+l+")":"$"):(b=e[e.length-1],m="string"==typeof b?-1<h.indexOf(b[b.length-1]):void 0===b,i||(c+="(?:"+h+"(?="+l+"))?"),m||(c+="(?="+h+"|"+l+")"))}return new RegExp(c,A(r))}(o(e,r),t,r)}function p(e,t,r){return e instanceof RegExp?function(e,t){if(!t)return e;var r=e.source.match(/\((?!\?)/g);if(r)for(var n=0;n<r.length;n++)t.push({name:n,prefix:"",suffix:"",modifier:"",pattern:""});return e}(e,t):Array.isArray(e)?(n=t,i=r,o=e.map(function(e){return p(e,n,i).source}),new RegExp("(?:"+o.join("|")+")",A(i))):u(e,t,r);var n,i,o}var a=(f.prototype.add=function(t){this.listeners.some(function(e){return e===t})||this.listeners.push(t)},f.prototype.concat=function(e){this.listeners=this.listeners.concat(e.listeners)},f.prototype.size=function(){return this.listeners.length},f.prototype.at=function(e){return this.listeners[e]},f.prototype.isExists=function(e){return-1!==this.listeners.indexOf(e)},f.prototype.remove=function(e){var t=this.listeners.indexOf(e);return-1!==t&&this.listeners.splice(t,1),-1!=t},f.prototype.each=function(e){for(var t=this.listeners,r=0;r<t.length;++r)e(t[r],r)},f.prototype.any=function(e){for(var t=!1,r=this.listeners,n=0;n<r.length;++n)var i=r[n],t=Boolean(e(i))||t;return t},f);function f(){this.listeners=[]}var l=(h.prototype.subscribe=function(e,t){var r=this.regexps[e],n=(r=r||(this.regexps[e]={list:new a,match:s(e)})).list.isExists(t);return n||r.list.add(t),!n},h.prototype.unsubscribe=function(e,t){var r=this.regexps[e];if(!r)return!1;if(t){var n=r.list.remove(t);return n&&0===r.list.size()&&delete this.regexps[e],n}return delete this.regexps[e],!0},h.prototype.publish=function(t,r,n){var e=t.channel,i=this.buildCacheLine(e),o=this;return i.any(function(e){if(n&&n!==e)return!1;if(r===e)return!1;try{return e.process(t,r)}catch(e){return o.logger.error("Error during processing event",t,", error:",e),!1}})},h.prototype.getAllChannels=function(){return Object.keys(this.regexps)},h.prototype.buildCacheLine=function(e){var t=new a;for(var r in this.regexps){var n=this.regexps[r];n.match(e)&&t.concat(n.list)}return t},h);function h(e){this.regexps={},this.logger=new r("regexp-bus",e.level,e)}var c=(d.prototype.addDispatcher=function(e){-1===this.dispatchers.indexOf(e)?this.dispatchers.push(e):this.logger.warn("trying to add existance dispatcher")},d.prototype.removeDispatcher=function(e){var t=this.dispatchers.indexOf(e);-1!==t&&this.dispatchers.splice(t,1)},d.prototype.subscribe=function(t,r){this.regExpBus.subscribe(t,r)&&this.dispatchers.forEach(function(e){e.onSubscribe(t,r)})},d.prototype.unsubscribe=function(t,r){var e=this.regExpBus.unsubscribe(t,r);return e&&this.dispatchers.forEach(function(e){e.onUnsubscribe(t,r)}),e},d.prototype.publish=function(e,t,r){var n={channel:e,data:t};return this.regExpBus.publish(n,r)},d);function d(e){this.dispatchers=[],this.logger=new r("ipbus",void 0,e),this.regExpBus=new l(this.logger)}var v=(g.prototype.process=function(e,t){return!!this.handler&&this.handler(e,t)},g);function g(e,t){this.originId=(t||"simple")+"-"+(new Date).getTime(),this.handler=e?e.bind(this):void 0}e.IpBus=c,e.ListListeners=a,e.LoggerConsole=r,e.SimpleListener=v,e.assertNotNull=function(e,t){if(null==e)throw new Error(t||"assertNotNull failed");return e},e.assertNull=function(e,t){if(null!=e)throw new Error(t||"assertNull failed");return e},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ipsub.min.js.map
